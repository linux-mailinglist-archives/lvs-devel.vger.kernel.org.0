Return-Path: <lvs-devel-owner@vger.kernel.org>
X-Original-To: lists+lvs-devel@lfdr.de
Delivered-To: lists+lvs-devel@lfdr.de
Received: from out1.vger.email (out1.vger.email [IPv6:2620:137:e000::1:20])
	by mail.lfdr.de (Postfix) with ESMTP id 63E944AA2A0
	for <lists+lvs-devel@lfdr.de>; Fri,  4 Feb 2022 22:52:38 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S241517AbiBDVwh (ORCPT <rfc822;lists+lvs-devel@lfdr.de>);
        Fri, 4 Feb 2022 16:52:37 -0500
Received: from forward106p.mail.yandex.net ([77.88.28.109]:41080 "EHLO
        forward106p.mail.yandex.net" rhost-flags-OK-OK-OK-OK)
        by vger.kernel.org with ESMTP id S234292AbiBDVwh (ORCPT
        <rfc822;lvs-devel@vger.kernel.org>); Fri, 4 Feb 2022 16:52:37 -0500
Received: from forward101q.mail.yandex.net (forward101q.mail.yandex.net [IPv6:2a02:6b8:c0e:4b:0:640:4012:bb98])
        by forward106p.mail.yandex.net (Yandex) with ESMTP id 90B552FC1115
        for <lvs-devel@vger.kernel.org>; Sat,  5 Feb 2022 00:52:35 +0300 (MSK)
Received: from vla1-765d064640cd.qloud-c.yandex.net (vla1-765d064640cd.qloud-c.yandex.net [IPv6:2a02:6b8:c0d:90b:0:640:765d:646])
        by forward101q.mail.yandex.net (Yandex) with ESMTP id 8D0CD13E80002
        for <lvs-devel@vger.kernel.org>; Sat,  5 Feb 2022 00:52:35 +0300 (MSK)
Received: from vla5-047c0c0d12a6.qloud-c.yandex.net (vla5-047c0c0d12a6.qloud-c.yandex.net [2a02:6b8:c18:3484:0:640:47c:c0d])
        by vla1-765d064640cd.qloud-c.yandex.net (mxback/Yandex) with ESMTP id McPkKh1sen-qZdqcT7I;
        Sat, 05 Feb 2022 00:52:35 +0300
Authentication-Results: vla1-765d064640cd.qloud-c.yandex.net; dkim=pass
Received: by vla5-047c0c0d12a6.qloud-c.yandex.net (smtp/Yandex) with ESMTPSA id LVynBIZeJi-qYI07VPH;
        Sat, 05 Feb 2022 00:52:34 +0300
        (using TLSv1.2 with cipher ECDHE-RSA-AES128-GCM-SHA256 (128/128 bits))
        (Client certificate not present)
X-Yandex-Fwd: 2
From:   "Sergey V. Lobanov" <sergey@lobanov.in>
To:     lvs-devel@vger.kernel.org
Cc:     "Sergey V. Lobanov" <sergey@lobanov.in>
Subject: [PATCH] ipvsadm: allow to redefine AR (libipvs)
Date:   Sat,  5 Feb 2022 00:52:15 +0300
Message-Id: <20220204215215.94422-1-sergey@lobanov.in>
X-Mailer: git-send-email 2.32.0 (Apple Git-132)
MIME-Version: 1.0
Content-Transfer-Encoding: 8bit
Precedence: bulk
List-ID: <lvs-devel.vger.kernel.org>
X-Mailing-List: lvs-devel@vger.kernel.org

libipvs Makefile uses `ar` to build archive. On cross-compile
cross-platfrom build it fails due system ar might be incompatible
with the objects generated by $(CC). It happens if build ipvsadm
on macos using GCC Toolchain (Linux target)

This patch allows to redefine `ar` using AR var in libipvs Makefile

Signed-off-by: Sergey V. Lobanov <sergey@lobanov.in>
---
 libipvs/Makefile | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/libipvs/Makefile b/libipvs/Makefile
index f845c8b..7e02d4d 100644
--- a/libipvs/Makefile
+++ b/libipvs/Makefile
@@ -1,5 +1,6 @@
 # Makefile for libipvs
 
+AR		= ar
 CC		= gcc
 CFLAGS		= -Wall -Wunused -Wstrict-prototypes -g -fPIC
 ifneq (0,$(HAVE_NL))
@@ -30,7 +31,7 @@ SHARED_LIB	= libipvs.so
 all:		$(STATIC_LIB) $(SHARED_LIB)
 
 $(STATIC_LIB):	libipvs.o ip_vs_nl_policy.o
-		ar rv $@ $^
+		$(AR) rv $@ $^
 
 $(SHARED_LIB):	libipvs.o ip_vs_nl_policy.o
 		$(CC) -shared -Wl,-soname,$@ -o $@ $^
-- 
2.32.0 (Apple Git-132)

